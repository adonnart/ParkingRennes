@{
    ViewBag.Title = "Home Page";
}

<form class="mt-3">
    <div class="form-group">
        <label for="recherche">Rechercher</label>
        <input type="text" class="form-control" id="recherche" aria-describedby="recherche" placeholder="Adresse, Lieu">
    </div>
    <div class="form-group">
        <button class="btn btn-primary">Rechercher</button>
    </div>
</form>

<div id="mapid"></div>

@section scripts {
    <script type="text/javascript">
        var mymap = L.map('mapid').setView([48.038, -1.692], 13);

        L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png?access_token={accessToken}', {
            attribution: 'Map data &copy; <a href="https://www.openstreetmap.org/">OpenStreetMap</a> contributors, <a href="https://creativecommons.org/licenses/by-sa/2.0/">CC-BY-SA</a>, Imagery © <a href="https://www.mapbox.com/">Mapbox</a>',
            maxZoom: 18,
            id: 'mapbox.streets',
            accessToken: 'your.mapbox.access.token'
        }).addTo(mymap);

        var markers = [];

        var wsg84 = '48.114,-1.683, 1000';

        $.get("https://data.rennesmetropole.fr/api/records/1.0/search/?dataset=export-api-parking-citedia", { 'geofilter.distance': wsg84 },
            function (data, status) {
                var records = data.records;
                console.log(records);
                for (var i = 0; i < records.length; i++) {
                    var record = data.records[i];
                    var x = record.geometry.coordinates[1];
                    var y = record.geometry.coordinates[0];
                    var marker = L.marker([x, y]).addTo(mymap);
                    markers.push(marker);
                    markers[i].bindPopup("<b>" + record.fields.key + "</b><br>" + record.fields.free + "/" + record.fields.max + "<br><span class='badge badge-success'>" + record.fields.status + "</span>").openPopup();
                    
                };
            });
        

        mymap.invalidateSize();

    </script>
}